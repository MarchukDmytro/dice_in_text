/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => DicePlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var import_view = require("@codemirror/view");
var import_state = require("@codemirror/state");
var DicePlugin = class extends import_obsidian.Plugin {
  onload() {
    console.log("Loading Dice Plugin");
    this.registerMarkdownPostProcessor((el) => {
      const diceRegex = /(\d+[dк]\d+([\+\-]\d+)?)/ig;
      el.querySelectorAll("p, li").forEach((block) => {
        block.innerHTML = block.innerHTML.replace(diceRegex, (match) => {
          return `<span class="clickable-dice" data-dice-formula="${match}">${match}</span>`;
        });
      });
    });
    this.registerEditorExtension(this.createLivePreviewPlugin());
    document.addEventListener("click", (evt) => {
      const target = evt.target;
      if (target.classList.contains("clickable-dice")) {
        const formula = target.getAttribute("data-dice-formula");
        if (formula) {
          const rollResult = this.rollDice(formula);
          const notice = new import_obsidian.Notice(rollResult.text, 8e3);
          if (rollResult.cssClass) {
            notice.noticeEl.classList.add(rollResult.cssClass);
          }
        }
      }
    });
  }
  rollDice(formula) {
    const match = formula.match(/(\d+)[dк](\d+)([+-]\d+)?/i);
    if (!match) return { text: "Invalid dice formula" };
    const num = parseInt(match[1], 10);
    const sides = parseInt(match[2], 10);
    const modifier = match[3] ? parseInt(match[3], 10) : 0;
    let rolls = [];
    let baseSum = 0;
    for (let i = 0; i < num; i++) {
      const roll = Math.floor(Math.random() * sides) + 1;
      rolls.push(roll);
      baseSum += roll;
    }
    const finalSum = baseSum + modifier;
    let noticeText = `\u{1F3B2} ${formula}
`;
    noticeText += `Rolls: [${rolls.join("] [")}]
`;
    noticeText += `Sum: ${baseSum}`;
    if (modifier !== 0) {
      noticeText += ` ${modifier > 0 ? "+" : "-"} ${Math.abs(modifier)}`;
    }
    noticeText += ` = ${finalSum}`;
    let cssClass;
    if (num === 1 && sides === 20) {
      if (rolls[0] === 20) cssClass = "dice-critical-success";
      if (rolls[0] === 1) cssClass = "dice-critical-fail";
    }
    return { text: noticeText, cssClass };
  }
  createLivePreviewPlugin() {
    const diceRegex = /(\d+[dк]\d+([\+\-]\d+)?)/ig;
    return import_view.ViewPlugin.fromClass(class {
      constructor(view) {
        this.decorations = this.buildDecorations(view);
      }
      update(update) {
        if (update.docChanged || update.viewportChanged) {
          this.decorations = this.buildDecorations(update.view);
        }
      }
      buildDecorations(view) {
        const builder = new import_state.RangeSetBuilder();
        for (let { from, to } of view.visibleRanges) {
          const text = view.state.doc.sliceString(from, to);
          let match;
          while ((match = diceRegex.exec(text)) !== null) {
            const start = from + match.index;
            const end = start + match[0].length;
            builder.add(
              start,
              end,
              import_view.Decoration.mark({
                class: "clickable-dice",
                attributes: { "data-dice-formula": match[0] }
              })
            );
          }
        }
        return builder.finish();
      }
    }, {
      decorations: (v) => v.decorations
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBQbHVnaW4sIE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgRGVjb3JhdGlvbiwgRWRpdG9yVmlldywgVmlld1BsdWdpbiwgVmlld1VwZGF0ZSB9IGZyb20gXCJAY29kZW1pcnJvci92aWV3XCI7XG5pbXBvcnQgeyBSYW5nZVNldEJ1aWxkZXIgfSBmcm9tIFwiQGNvZGVtaXJyb3Ivc3RhdGVcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGljZVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG5cdG9ubG9hZCgpIHtcblx0XHRjb25zb2xlLmxvZyhcIkxvYWRpbmcgRGljZSBQbHVnaW5cIik7XG5cblx0XHQvLyBSZWFkaW5nIHZpZXcgKHByZXZpZXcpXG5cdFx0dGhpcy5yZWdpc3Rlck1hcmtkb3duUG9zdFByb2Nlc3NvcigoZWwpID0+IHtcblx0XHRcdGNvbnN0IGRpY2VSZWdleCA9IC8oXFxkK1tkXHUwNDNBXVxcZCsoW1xcK1xcLV1cXGQrKT8pL2lnO1xuXHRcdFx0ZWwucXVlcnlTZWxlY3RvckFsbChcInAsIGxpXCIpLmZvckVhY2goKGJsb2NrKSA9PiB7XG5cdFx0XHRcdGJsb2NrLmlubmVySFRNTCA9IGJsb2NrLmlubmVySFRNTC5yZXBsYWNlKGRpY2VSZWdleCwgKG1hdGNoKSA9PiB7XG5cdFx0XHRcdFx0cmV0dXJuIGA8c3BhbiBjbGFzcz1cImNsaWNrYWJsZS1kaWNlXCIgZGF0YS1kaWNlLWZvcm11bGE9XCIke21hdGNofVwiPiR7bWF0Y2h9PC9zcGFuPmA7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHQvLyBMaXZlIFByZXZpZXcgKGVkaXRvcilcblx0XHR0aGlzLnJlZ2lzdGVyRWRpdG9yRXh0ZW5zaW9uKHRoaXMuY3JlYXRlTGl2ZVByZXZpZXdQbHVnaW4oKSk7XG5cblx0XHQvLyBIYW5kbGUgY2xpY2tzIGdsb2JhbGx5XG5cdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcblx0XHRcdGNvbnN0IHRhcmdldCA9IGV2dC50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG5cdFx0XHRpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNsaWNrYWJsZS1kaWNlXCIpKSB7XG5cdFx0XHRcdGNvbnN0IGZvcm11bGEgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS1kaWNlLWZvcm11bGFcIik7XG5cdFx0XHRcdGlmIChmb3JtdWxhKSB7XG5cdFx0XHRcdFx0Y29uc3Qgcm9sbFJlc3VsdCA9IHRoaXMucm9sbERpY2UoZm9ybXVsYSk7XG5cblx0XHRcdFx0XHQvLyBDcmVhdGUgc3R5bGVkIG5vdGljZVxuXHRcdFx0XHRcdGNvbnN0IG5vdGljZSA9IG5ldyBOb3RpY2Uocm9sbFJlc3VsdC50ZXh0LCA4MDAwKTtcblx0XHRcdFx0XHQvLyBBZGQgQ1NTIGNsYXNzIGZvciBjcml0aWNhbHNcblx0XHRcdFx0XHRpZiAocm9sbFJlc3VsdC5jc3NDbGFzcykge1xuXHRcdFx0XHRcdFx0bm90aWNlLm5vdGljZUVsLmNsYXNzTGlzdC5hZGQocm9sbFJlc3VsdC5jc3NDbGFzcyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHRyb2xsRGljZShmb3JtdWxhOiBzdHJpbmcpOiB7IHRleHQ6IHN0cmluZzsgY3NzQ2xhc3M/OiBzdHJpbmcgfSB7XG5cdFx0Y29uc3QgbWF0Y2ggPSBmb3JtdWxhLm1hdGNoKC8oXFxkKylbZFx1MDQzQV0oXFxkKykoWystXVxcZCspPy9pKTtcblx0XHRpZiAoIW1hdGNoKSByZXR1cm4geyB0ZXh0OiBcIkludmFsaWQgZGljZSBmb3JtdWxhXCIgfTtcblxuXHRcdGNvbnN0IG51bSA9IHBhcnNlSW50KG1hdGNoWzFdLCAxMCk7XG5cdFx0Y29uc3Qgc2lkZXMgPSBwYXJzZUludChtYXRjaFsyXSwgMTApO1xuXHRcdGNvbnN0IG1vZGlmaWVyID0gbWF0Y2hbM10gPyBwYXJzZUludChtYXRjaFszXSwgMTApIDogMDtcblxuXHRcdGxldCByb2xsczogbnVtYmVyW10gPSBbXTtcblx0XHRsZXQgYmFzZVN1bSA9IDA7XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBudW07IGkrKykge1xuXHRcdFx0Y29uc3Qgcm9sbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHNpZGVzKSArIDE7XG5cdFx0XHRyb2xscy5wdXNoKHJvbGwpO1xuXHRcdFx0YmFzZVN1bSArPSByb2xsO1xuXHRcdH1cblx0XHRjb25zdCBmaW5hbFN1bSA9IGJhc2VTdW0gKyBtb2RpZmllcjtcblxuXHRcdC8vIFByZXR0eSBicmVha2Rvd25cblx0XHRsZXQgbm90aWNlVGV4dCA9IGBcdUQ4M0NcdURGQjIgJHtmb3JtdWxhfVxcbmA7XG5cdFx0bm90aWNlVGV4dCArPSBgUm9sbHM6IFske3JvbGxzLmpvaW4oXCJdIFtcIil9XVxcbmA7XG5cdFx0bm90aWNlVGV4dCArPSBgU3VtOiAke2Jhc2VTdW19YDtcblx0XHRpZiAobW9kaWZpZXIgIT09IDApIHtcblx0XHRcdG5vdGljZVRleHQgKz0gYCAke21vZGlmaWVyID4gMCA/IFwiK1wiIDogXCItXCJ9ICR7TWF0aC5hYnMobW9kaWZpZXIpfWA7XG5cdFx0fVxuXHRcdG5vdGljZVRleHQgKz0gYCA9ICR7ZmluYWxTdW19YDtcblxuXHRcdC8vIERldGVjdCBjcml0aWNhbCBzdWNjZXNzL2ZhaWx1cmUgKG9ubHkgaWYgaXQncyAxZDIwIFx1MDBCMSBtb2RpZmllcilcblx0XHRsZXQgY3NzQ2xhc3M6IHN0cmluZyB8IHVuZGVmaW5lZDtcblx0XHRpZiAobnVtID09PSAxICYmIHNpZGVzID09PSAyMCkge1xuXHRcdFx0aWYgKHJvbGxzWzBdID09PSAyMCkgY3NzQ2xhc3MgPSBcImRpY2UtY3JpdGljYWwtc3VjY2Vzc1wiO1xuXHRcdFx0aWYgKHJvbGxzWzBdID09PSAxKSBjc3NDbGFzcyA9IFwiZGljZS1jcml0aWNhbC1mYWlsXCI7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHsgdGV4dDogbm90aWNlVGV4dCwgY3NzQ2xhc3MgfTtcblx0fVxuXG5cblx0Y3JlYXRlTGl2ZVByZXZpZXdQbHVnaW4oKSB7XG5cdFx0Y29uc3QgZGljZVJlZ2V4ID0gLyhcXGQrW2RcdTA0M0FdXFxkKyhbXFwrXFwtXVxcZCspPykvaWc7XG5cblx0XHRyZXR1cm4gVmlld1BsdWdpbi5mcm9tQ2xhc3MoY2xhc3Mge1xuXHRcdFx0ZGVjb3JhdGlvbnM7XG5cblx0XHRcdGNvbnN0cnVjdG9yKHZpZXc6IEVkaXRvclZpZXcpIHtcblx0XHRcdFx0dGhpcy5kZWNvcmF0aW9ucyA9IHRoaXMuYnVpbGREZWNvcmF0aW9ucyh2aWV3KTtcblx0XHRcdH1cblxuXHRcdFx0dXBkYXRlKHVwZGF0ZTogVmlld1VwZGF0ZSkge1xuXHRcdFx0XHRpZiAodXBkYXRlLmRvY0NoYW5nZWQgfHwgdXBkYXRlLnZpZXdwb3J0Q2hhbmdlZCkge1xuXHRcdFx0XHRcdHRoaXMuZGVjb3JhdGlvbnMgPSB0aGlzLmJ1aWxkRGVjb3JhdGlvbnModXBkYXRlLnZpZXcpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRidWlsZERlY29yYXRpb25zKHZpZXc6IEVkaXRvclZpZXcpIHtcblx0XHRcdFx0Y29uc3QgYnVpbGRlciA9IG5ldyBSYW5nZVNldEJ1aWxkZXI8RGVjb3JhdGlvbj4oKTtcblx0XHRcdFx0Zm9yIChsZXQgeyBmcm9tLCB0byB9IG9mIHZpZXcudmlzaWJsZVJhbmdlcykge1xuXHRcdFx0XHRcdGNvbnN0IHRleHQgPSB2aWV3LnN0YXRlLmRvYy5zbGljZVN0cmluZyhmcm9tLCB0byk7XG5cdFx0XHRcdFx0bGV0IG1hdGNoO1xuXHRcdFx0XHRcdHdoaWxlICgobWF0Y2ggPSBkaWNlUmVnZXguZXhlYyh0ZXh0KSkgIT09IG51bGwpIHtcblx0XHRcdFx0XHRcdGNvbnN0IHN0YXJ0ID0gZnJvbSArIG1hdGNoLmluZGV4O1xuXHRcdFx0XHRcdFx0Y29uc3QgZW5kID0gc3RhcnQgKyBtYXRjaFswXS5sZW5ndGg7XG5cdFx0XHRcdFx0XHRidWlsZGVyLmFkZChcblx0XHRcdFx0XHRcdFx0c3RhcnQsXG5cdFx0XHRcdFx0XHRcdGVuZCxcblx0XHRcdFx0XHRcdFx0RGVjb3JhdGlvbi5tYXJrKHtcblx0XHRcdFx0XHRcdFx0XHRjbGFzczogXCJjbGlja2FibGUtZGljZVwiLFxuXHRcdFx0XHRcdFx0XHRcdGF0dHJpYnV0ZXM6IHsgXCJkYXRhLWRpY2UtZm9ybXVsYVwiOiBtYXRjaFswXSB9XG5cdFx0XHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gYnVpbGRlci5maW5pc2goKTtcblx0XHRcdH1cblx0XHR9LCB7XG5cdFx0XHRkZWNvcmF0aW9uczogdiA9PiB2LmRlY29yYXRpb25zXG5cdFx0fSk7XG5cdH1cbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQkFBb0M7QUFDcEMsa0JBQStEO0FBQy9ELG1CQUFnQztBQUVoQyxJQUFxQixhQUFyQixjQUF3Qyx1QkFBTztBQUFBLEVBQzlDLFNBQVM7QUFDUixZQUFRLElBQUkscUJBQXFCO0FBR2pDLFNBQUssOEJBQThCLENBQUMsT0FBTztBQUMxQyxZQUFNLFlBQVk7QUFDbEIsU0FBRyxpQkFBaUIsT0FBTyxFQUFFLFFBQVEsQ0FBQyxVQUFVO0FBQy9DLGNBQU0sWUFBWSxNQUFNLFVBQVUsUUFBUSxXQUFXLENBQUMsVUFBVTtBQUMvRCxpQkFBTyxtREFBbUQsS0FBSyxLQUFLLEtBQUs7QUFBQSxRQUMxRSxDQUFDO0FBQUEsTUFDRixDQUFDO0FBQUEsSUFDRixDQUFDO0FBR0QsU0FBSyx3QkFBd0IsS0FBSyx3QkFBd0IsQ0FBQztBQUczRCxhQUFTLGlCQUFpQixTQUFTLENBQUMsUUFBUTtBQUMzQyxZQUFNLFNBQVMsSUFBSTtBQUNuQixVQUFJLE9BQU8sVUFB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
