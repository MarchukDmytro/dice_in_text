/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => DicePlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var import_view = require("@codemirror/view");
var import_state = require("@codemirror/state");
var DicePlugin = class extends import_obsidian.Plugin {
  onload() {
    console.log("Loading Dice Plugin");
    this.registerMarkdownPostProcessor((el) => {
      const diceRegex = /(\d+[dк]\d+([\+\-]\d+)?)/ig;
      el.querySelectorAll("p, li").forEach((block) => {
        block.innerHTML = block.innerHTML.replace(diceRegex, (match) => {
          return `<span class="clickable-dice" data-dice-formula="${match}">${match}</span>`;
        });
      });
    });
    this.registerEditorExtension(this.createLivePreviewPlugin());
    document.addEventListener("click", (evt) => {
      const target = evt.target;
      if (target.classList.contains("clickable-dice")) {
        const formula = target.getAttribute("data-dice-formula");
        if (formula) {
          const rollResult = this.rollDice(formula);
          const notice = new import_obsidian.Notice(rollResult.text, 8e3);
          if (rollResult.cssClass) {
            notice.noticeEl.classList.add(rollResult.cssClass);
          }
        }
      }
    });
  }
  rollDice(formula) {
    const match = formula.match(/(\d+)[dк](\d+)([+-]\d+)?/i);
    if (!match) return "Invalid dice formula";
    const num = parseInt(match[1], 10);
    const sides = parseInt(match[2], 10);
    const modifier = match[3] ? parseInt(match[3], 10) : 0;
    let rolls = [];
    let baseSum = 0;
    for (let i = 0; i < num; i++) {
      const roll = Math.floor(Math.random() * sides) + 1;
      rolls.push(roll);
      baseSum += roll;
    }
    const finalSum = baseSum + modifier;
    let noticeText = `\u{1F3B2} ${formula}
`;
    noticeText += `Rolls: [${rolls.join("] [")}]
`;
    noticeText += `Sum: ${baseSum}`;
    if (modifier !== 0) {
      noticeText += ` ${modifier > 0 ? "+" : "-"} ${Math.abs(modifier)}`;
    }
    noticeText += ` = ${finalSum}`;
    let cssClass;
    if (formula.toLowerCase() === "1d20") {
      if (rolls[0] === 20) cssClass = "dice-critical-success";
      if (rolls[0] === 1) cssClass = "dice-critical-fail";
    }
    return { text: noticeText, cssClass };
  }
  createLivePreviewPlugin() {
    const diceRegex = /(\d+[dк]\d+([\+\-]\d+)?)/ig;
    return import_view.ViewPlugin.fromClass(class {
      constructor(view) {
        this.decorations = this.buildDecorations(view);
      }
      update(update) {
        if (update.docChanged || update.viewportChanged) {
          this.decorations = this.buildDecorations(update.view);
        }
      }
      buildDecorations(view) {
        const builder = new import_state.RangeSetBuilder();
        for (let { from, to } of view.visibleRanges) {
          const text = view.state.doc.sliceString(from, to);
          let match;
          while ((match = diceRegex.exec(text)) !== null) {
            const start = from + match.index;
            const end = start + match[0].length;
            builder.add(
              start,
              end,
              import_view.Decoration.mark({
                class: "clickable-dice",
                attributes: { "data-dice-formula": match[0] }
              })
            );
          }
        }
        return builder.finish();
      }
    }, {
      decorations: (v) => v.decorations
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBQbHVnaW4sIE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgRGVjb3JhdGlvbiwgRWRpdG9yVmlldywgVmlld1BsdWdpbiwgVmlld1VwZGF0ZSB9IGZyb20gXCJAY29kZW1pcnJvci92aWV3XCI7XG5pbXBvcnQgeyBSYW5nZVNldEJ1aWxkZXIgfSBmcm9tIFwiQGNvZGVtaXJyb3Ivc3RhdGVcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGljZVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG5cdG9ubG9hZCgpIHtcblx0XHRjb25zb2xlLmxvZyhcIkxvYWRpbmcgRGljZSBQbHVnaW5cIik7XG5cblx0XHQvLyBSZWFkaW5nIHZpZXcgKHByZXZpZXcpXG5cdFx0dGhpcy5yZWdpc3Rlck1hcmtkb3duUG9zdFByb2Nlc3NvcigoZWwpID0+IHtcblx0XHRcdGNvbnN0IGRpY2VSZWdleCA9IC8oXFxkK1tkXHUwNDNBXVxcZCsoW1xcK1xcLV1cXGQrKT8pL2lnO1xuXHRcdFx0ZWwucXVlcnlTZWxlY3RvckFsbChcInAsIGxpXCIpLmZvckVhY2goKGJsb2NrKSA9PiB7XG5cdFx0XHRcdGJsb2NrLmlubmVySFRNTCA9IGJsb2NrLmlubmVySFRNTC5yZXBsYWNlKGRpY2VSZWdleCwgKG1hdGNoKSA9PiB7XG5cdFx0XHRcdFx0cmV0dXJuIGA8c3BhbiBjbGFzcz1cImNsaWNrYWJsZS1kaWNlXCIgZGF0YS1kaWNlLWZvcm11bGE9XCIke21hdGNofVwiPiR7bWF0Y2h9PC9zcGFuPmA7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHQvLyBMaXZlIFByZXZpZXcgKGVkaXRvcilcblx0XHR0aGlzLnJlZ2lzdGVyRWRpdG9yRXh0ZW5zaW9uKHRoaXMuY3JlYXRlTGl2ZVByZXZpZXdQbHVnaW4oKSk7XG5cblx0XHQvLyBIYW5kbGUgY2xpY2tzIGdsb2JhbGx5XG5cdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcblx0XHRcdGNvbnN0IHRhcmdldCA9IGV2dC50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG5cdFx0XHRpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNsaWNrYWJsZS1kaWNlXCIpKSB7XG5cdFx0XHRcdGNvbnN0IGZvcm11bGEgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS1kaWNlLWZvcm11bGFcIik7XG5cdFx0XHRcdGlmIChmb3JtdWxhKSB7XG5cdFx0XHRcdFx0Y29uc3Qgcm9sbFJlc3VsdCA9IHRoaXMucm9sbERpY2UoZm9ybXVsYSk7XG5cblx0XHRcdFx0XHQvLyBDcmVhdGUgc3R5bGVkIG5vdGljZVxuXHRcdFx0XHRcdGNvbnN0IG5vdGljZSA9IG5ldyBOb3RpY2Uocm9sbFJlc3VsdC50ZXh0LCA4MDAwKTtcblx0XHRcdFx0XHQvLyBBZGQgQ1NTIGNsYXNzIGZvciBjcml0aWNhbHNcblx0XHRcdFx0XHRpZiAocm9sbFJlc3VsdC5jc3NDbGFzcykge1xuXHRcdFx0XHRcdFx0bm90aWNlLm5vdGljZUVsLmNsYXNzTGlzdC5hZGQocm9sbFJlc3VsdC5jc3NDbGFzcyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblx0XHQgXG5cdHJvbGxEaWNlKGZvcm11bGE6IHN0cmluZyk6IHN0cmluZyB7XG5cdFx0Y29uc3QgbWF0Y2ggPSBmb3JtdWxhLm1hdGNoKC8oXFxkKylbZFx1MDQzQV0oXFxkKykoWystXVxcZCspPy9pKTtcblx0XHRpZiAoIW1hdGNoKSByZXR1cm4gXCJJbnZhbGlkIGRpY2UgZm9ybXVsYVwiO1xuXG5cdFx0Y29uc3QgbnVtID0gcGFyc2VJbnQobWF0Y2hbMV0sIDEwKTtcblx0XHRjb25zdCBzaWRlcyA9IHBhcnNlSW50KG1hdGNoWzJdLCAxMCk7XG5cdFx0Y29uc3QgbW9kaWZpZXIgPSBtYXRjaFszXSA/IHBhcnNlSW50KG1hdGNoWzNdLCAxMCkgOiAwO1xuXG5cdFx0bGV0IHJvbGxzOiBudW1iZXJbXSA9IFtdO1xuXHRcdGxldCBiYXNlU3VtID0gMDtcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IG51bTsgaSsrKSB7XG5cdFx0XHRjb25zdCByb2xsID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc2lkZXMpICsgMTtcblx0XHRcdHJvbGxzLnB1c2gocm9sbCk7XG5cdFx0XHRiYXNlU3VtICs9IHJvbGw7XG5cdFx0fVxuXHRcdGNvbnN0IGZpbmFsU3VtID0gYmFzZVN1bSArIG1vZGlmaWVyO1xuXG5cdFx0Ly8gUHJldHR5IGJyZWFrZG93blxuXHRcdGxldCBub3RpY2VUZXh0ID0gYFx1RDgzQ1x1REZCMiAke2Zvcm11bGF9XFxuYDtcblx0XHRub3RpY2VUZXh0ICs9IGBSb2xsczogWyR7cm9sbHMuam9pbihcIl0gW1wiKX1dXFxuYDtcblx0XHRub3RpY2VUZXh0ICs9IGBTdW06ICR7YmFzZVN1bX1gO1xuXHRcdGlmIChtb2RpZmllciAhPT0gMCkge1xuXHRcdFx0bm90aWNlVGV4dCArPSBgICR7bW9kaWZpZXIgPiAwID8gXCIrXCIgOiBcIi1cIn0gJHtNYXRoLmFicyhtb2RpZmllcil9YDtcblx0XHR9XG5cdFx0bm90aWNlVGV4dCArPSBgID0gJHtmaW5hbFN1bX1gO1xuXG5cdFx0XHRcdC8vIERldGVjdCBjcml0aWNhbCBzdWNjZXNzL2ZhaWx1cmVcblx0XHRsZXQgY3NzQ2xhc3M6IHN0cmluZyB8IHVuZGVmaW5lZDtcblx0XHRpZiAoZm9ybXVsYS50b0xvd2VyQ2FzZSgpID09PSBcIjFkMjBcIikge1xuXHRcdFx0aWYgKHJvbGxzWzBdID09PSAyMCkgY3NzQ2xhc3MgPSBcImRpY2UtY3JpdGljYWwtc3VjY2Vzc1wiO1xuXHRcdFx0aWYgKHJvbGxzWzBdID09PSAxKSBjc3NDbGFzcyA9IFwiZGljZS1jcml0aWNhbC1mYWlsXCI7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHsgdGV4dDogbm90aWNlVGV4dCwgY3NzQ2xhc3MgfTtcblx0fVxuXG5cdGNyZWF0ZUxpdmVQcmV2aWV3UGx1Z2luKCkge1xuXHRcdGNvbnN0IGRpY2VSZWdleCA9IC8oXFxkK1tkXHUwNDNBXVxcZCsoW1xcK1xcLV1cXGQrKT8pL2lnO1xuXG5cdFx0cmV0dXJuIFZpZXdQbHVnaW4uZnJvbUNsYXNzKGNsYXNzIHtcblx0XHRcdGRlY29yYXRpb25zO1xuXG5cdFx0XHRjb25zdHJ1Y3Rvcih2aWV3OiBFZGl0b3JWaWV3KSB7XG5cdFx0XHRcdHRoaXMuZGVjb3JhdGlvbnMgPSB0aGlzLmJ1aWxkRGVjb3JhdGlvbnModmlldyk7XG5cdFx0XHR9XG5cblx0XHRcdHVwZGF0ZSh1cGRhdGU6IFZpZXdVcGRhdGUpIHtcblx0XHRcdFx0aWYgKHVwZGF0ZS5kb2NDaGFuZ2VkIHx8IHVwZGF0ZS52aWV3cG9ydENoYW5nZWQpIHtcblx0XHRcdFx0XHR0aGlzLmRlY29yYXRpb25zID0gdGhpcy5idWlsZERlY29yYXRpb25zKHVwZGF0ZS52aWV3KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0YnVpbGREZWNvcmF0aW9ucyh2aWV3OiBFZGl0b3JWaWV3KSB7XG5cdFx0XHRcdGNvbnN0IGJ1aWxkZXIgPSBuZXcgUmFuZ2VTZXRCdWlsZGVyPERlY29yYXRpb24+KCk7XG5cdFx0XHRcdGZvciAobGV0IHsgZnJvbSwgdG8gfSBvZiB2aWV3LnZpc2libGVSYW5nZXMpIHtcblx0XHRcdFx0XHRjb25zdCB0ZXh0ID0gdmlldy5zdGF0ZS5kb2Muc2xpY2VTdHJpbmcoZnJvbSwgdG8pO1xuXHRcdFx0XHRcdGxldCBtYXRjaDtcblx0XHRcdFx0XHR3aGlsZSAoKG1hdGNoID0gZGljZVJlZ2V4LmV4ZWModGV4dCkpICE9PSBudWxsKSB7XG5cdFx0XHRcdFx0XHRjb25zdCBzdGFydCA9IGZyb20gKyBtYXRjaC5pbmRleDtcblx0XHRcdFx0XHRcdGNvbnN0IGVuZCA9IHN0YXJ0ICsgbWF0Y2hbMF0ubGVuZ3RoO1xuXHRcdFx0XHRcdFx0YnVpbGRlci5hZGQoXG5cdFx0XHRcdFx0XHRcdHN0YXJ0LFxuXHRcdFx0XHRcdFx0XHRlbmQsXG5cdFx0XHRcdFx0XHRcdERlY29yYXRpb24ubWFyayh7XG5cdFx0XHRcdFx0XHRcdFx0Y2xhc3M6IFwiY2xpY2thYmxlLWRpY2VcIixcblx0XHRcdFx0XHRcdFx0XHRhdHRyaWJ1dGVzOiB7IFwiZGF0YS1kaWNlLWZvcm11bGFcIjogbWF0Y2hbMF0gfVxuXHRcdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIGJ1aWxkZXIuZmluaXNoKCk7XG5cdFx0XHR9XG5cdFx0fSwge1xuXHRcdFx0ZGVjb3JhdGlvbnM6IHYgPT4gdi5kZWNvcmF0aW9uc1xuXHRcdH0pO1xuXHR9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsc0JBQW9DO0FBQ3BDLGtCQUErRDtBQUMvRCxtQkFBZ0M7QUFFaEMsSUFBcUIsYUFBckIsY0FBd0MsdUJBQU87QUFBQSxFQUM5QyxTQUFTO0FBQ1IsWUFBUSxJQUFJLHFCQUFxQjtBQUdqQyxTQUFLLDhCQUE4QixDQUFDLE9BQU87QUFDMUMsWUFBTSxZQUFZO0FBQ2xCLFNBQUcsaUJBQWlCLE9BQU8sRUFBRSxRQUFRLENBQUMsVUFBVTtBQUMvQyxjQUFNLFlBQVksTUFBTSxVQUFVLFFBQVEsV0FBVyxDQUFDLFVBQVU7QUFDL0QsaUJBQU8sbURBQW1ELEtBQUssS0FBSyxLQUFLO0FBQUEsUUFDMUUsQ0FBQztBQUFBLE1BQ0YsQ0FBQztBQUFBLElBQ0YsQ0FBQztBQUdELFNBQUssd0JBQXdCLEtBQUssd0JBQXdCLENBQUM7QUFHM0QsYUFBUyxpQkFBaUIsU0FBUyxDQUFDLFFBQVE7QUFDM0MsWUFBTSxTQUFTLElBQUk7QUFDbkIsVUFBSSxPQUFPLFVBQVUsU0FBUyxnQkFBZ0IsR0FBRztBQUNoRCxjQUFNLFVBQVUsT0FBTyxhQUFhLG1CQUFtQjtBQUN2RCxZ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
